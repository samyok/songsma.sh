(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{236:function(e,t,n){},238:function(e,t,n){},243:function(e,t){},244:function(e,t){},252:function(e,t){},257:function(e,t,n){"use strict";n.r(t);var i=n(33),o=n.n(i),r=n(209),c=n.n(r),a=(n(236),n(20)),s=n(9),u=n.n(s),l=n(15),d=n(8),f=(n(238),n(210)),b=n.n(f),h=(n(256),n(230)),p=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function v(e,t){var n=Object(i.useRef)();Object(i.useEffect)((function(){n.current=e}),[e]),Object(i.useEffect)((function(){if(null!==t){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}}),[t])}var j=n(16),w=n(229),g=n(228),O=n(48),x=new g;x.showPanel(0);var y=function(){var e=Object(i.useRef)(),t=Object(i.useRef)(),n=Object(i.useState)("string"),o=Object(d.a)(n,2),r=o[0],c=o[1],s=Object(i.useState)(),f=Object(d.a)(s,2),g=f[0],y=f[1],m=Object(i.useState)(),k=Object(d.a)(m,2),S=k[0],I=k[1],M=Object(i.useState)(localStorage.getItem("CameraId")||{}),E=Object(d.a)(M,2),z=E[0],P=E[1],W=Object(i.useState)([]),C=Object(d.a)(W,2),T=C[0],R=C[1],H=Object(i.useState)(null),F=Object(d.a)(H,2),D=F[0],L=F[1],B=Object(i.useState)(null),J=Object(d.a)(B,2),X=J[0],q=J[1],N=Object(i.useState)(null),Y=Object(d.a)(N,2);Y[0],Y[1],Object(i.useEffect)((function(){window.addEventListener("resize",(function(e){window.location.reload()}))}),[]),v(Object(l.a)(u.a.mark((function n(){var i,o,r,a,s,l;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(g&&e.current&&(null===(i=e.current)||void 0===i?void 0:i.video)&&4===e.current.video.readyState&&(null===g||void 0===g?void 0:g.estimateSinglePose)&&(null===(o=t.current)||void 0===o?void 0:o.getContext)){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,g.estimateSinglePose(e.current.video,{flipHorizontal:!0});case 4:r=n.sent,(a=t.current.getContext("2d")).fillStyle="red",a.clearRect(0,0,a.canvas.width,a.canvas.height),r.keypoints.filter((function(e){return e.score>.1})).filter((function(e){return e.part.includes("Wrist")||e.part.includes("Elbow")})).forEach((function(e){a.fillRect(e.position.x,e.position.y,6,6)})),r.keypoints.filter((function(e){return"nose"===e.part}))[0].position.x,I((function(e){var t=e||{};return r.keypoints.forEach((function(e){t[e.part]=e.position})),t})),S&&(S.leftWrist&&S.leftElbow&&(a.strokeStyle="green",a.lineWidth=10,a.beginPath(),a.moveTo(S.leftWrist.x,S.leftWrist.y),a.lineTo(S.leftElbow.x,S.leftElbow.y),a.stroke(),a.lineWidth=0,X&&(X.scene.rotation.z=Math.PI/2,X.scene.scale.set(.1,.1,.1),X.scene.position.x=Math.min(S.leftElbow.x,S.leftWrist.x)/D.w*5-2.5,s=Math.sqrt(Math.pow(S.leftWrist.x-S.leftElbow.x,2)+Math.pow(S.leftWrist.y-S.leftElbow.y,2)),0,l=Math.asin(s/120),c(2*l*Math.PI),X.scene.rotation.x=Math.PI/4)),S.rightWrist&&S.rightElbow&&(a.strokeStyle="blue",a.lineWidth=10,a.beginPath(),a.moveTo(S.rightWrist.x,S.rightWrist.y),a.lineTo(S.rightElbow.x,S.rightElbow.y),a.stroke(),a.lineWidth=0));case 12:case"end":return n.stop()}}),n)}))),50);var Z=Object(i.useCallback)((function(e){R(e.filter((function(e){return"videoinput"===e.kind})))}),[R]),G=Object(i.useCallback)(function(){var n=Object(l.a)(u.a.mark((function n(i){var o;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:console.log(i,e.current.video);case 1:if(i.active&&e.current.video&&4===e.current.video.readyState&&t.current){n.next=6;break}return n.next=4,p(50);case 4:n.next=1;break;case 6:i.active&&e.current.video&&(o={w:e.current.video.videoWidth,h:e.current.video.videoHeight},L(o),t.current.height=o.h,t.current.width=o.w,e.current.video.height=o.h,e.current.video.width=o.w,U({width:o.w,height:o.h}).then((function(e){y(e)})));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),[]);function U(e){return A.apply(this,arguments)}function A(){return(A=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.width,t.height,console.log("Loading posenet..."),e.next=4,h.a({architecture:"ResNet50",outputStride:32,inputResolution:{width:250,height:200},quantBytes:2,multiplier:1});case 4:return n=e.sent,console.log("loaded posenet."),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(i.useEffect)((function(){navigator.mediaDevices.enumerateDevices().then(Z)}),[Z]);var K=Object(i.useState)([]),Q=Object(d.a)(K,2),V=Q[0],$=Q[1],_=Object(i.useState)(null),ee=Object(d.a)(_,2),te=ee[0],ne=ee[1],ie=Object(i.useState)(),oe=Object(d.a)(ie,2),re=oe[0],ce=oe[1],ae=Object(i.useState)(),se=Object(d.a)(ae,2),ue=se[0],le=se[1];Object(i.useEffect)(Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ce(new j.ab);case 1:case"end":return e.stop()}}),e)}))),[]),Object(i.useEffect)((function(){re&&(re.background=null,le(new j.R(75,window.innerWidth/window.innerHeight,.2,1e3)),ne(new j.mb({alpha:!0})))}),[re]);var de=new w.a;function fe(e,t,n,i){function o(n){switch(re.add(n.scene),n.scene.position.x=e-1.5,n.scene.position.y=t-1,n.scene.scale.set(.42,.42,.42),n.scene.rotation.x+=Math.PI,n.scene.rotation.z+=Math.PI,$((function(e){return[].concat(Object(a.a)(e),[n.scene])})),i){case 0:n.scene.rotation.z+=Math.PI;break;case 1:break;case 2:n.scene.rotation.z+=3*Math.PI/2;break;case 3:n.scene.rotation.z+=Math.PI/2;break;case 4:n.scene.rotation.z+=5*Math.PI/4;break;case 5:n.scene.rotation.z+=Math.PI/4;break;case 6:n.scene.rotation.z+=7*Math.PI/4;break;case 7:n.scene.rotation.z+=5*Math.PI/4}}0===n&&de.load("./redbox.glb",o),1===n&&de.load("./bluebox.glb",o)}return Object(i.useEffect)((function(){if(te&&re){te.setSize(window.innerWidth,window.innerHeight),te.outputEncoding=j.nb,document.body.appendChild(te.domElement);var e=new j.S(4,5e3,1),t=new j.H({color:"white",side:j.j,opacity:.5,transparent:!0}),n=new j.G(e,t);n.rotateX(Math.PI/2),n.position.y-=1.5,re.add(n);var i=[];i[0]=new j.T(16777215,5,0),i[1]=new j.T(16777215,.1,0),i[0].position.set(0,200,5),i[1].position.set(0,0,200);for(var o=0;o<i.length;o++)re.add(i[o]);re.fog=new j.l("black",5,15),document.body.appendChild(x.dom),fe(0,0,0,4),fe(1,1,1,5),fe(2,2,0,6),fe(3,2,1,7),function(e){var t=e.x,n=e.y,i=e.z,o=e.file,r=e.rotX,c=e.rotY,a=e.rotZ,s=e.callback;de.load(o,(function(e){re.add(e.scene),e.scene.scale.set(.42,.42,.42),e.scene.position.x=t,e.scene.position.y=n,e.scene.position.z=i,e.scene.rotation.x=r,e.scene.rotation.y=c,e.scene.rotation.z=a,s&&s(e)}))}({x:0,y:0,z:6,file:"./redsaber.glb",rotZ:Math.PI/2,rotY:0,rotX:0,callback:function(e){return q(e)}}),setTimeout((function(){return function(e,t){for(var n=function(n){if(Math.round(V[n].position.z)>5&&Math.round(V[n].position.x+1.5)===e&&Math.round(V[n].position.y+1)===t)return re.remove(V[n]),$((function(e){return e.splice(n,1),e})),{v:void 0}},i=0;i<V.length;i++){var o=n(i);if("object"===typeof o)return o.v}}(3,2)}),2e3),ue.position.z=10}}),[te]),v((function(){if(x.begin(),te){for(var e=0;e<V.length;e++)V[e].position.z+=.04,V[e].position.z>7&&(re.remove(V[e]),V.splice(e,1));te.render(re,ue),x.end()}}),1e3/30),Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("div",{children:[Object(O.jsx)("select",{value:z,onChange:function(e){P(e.currentTarget.value),localStorage.setItem("CameraId",e.currentTarget.value)},children:T.map((function(e,t){return Object(O.jsx)("option",{value:e.deviceId,children:e.label||"Device ".concat(t+1)},e.deviceId)}))}),Object(O.jsx)("br",{}),Object(O.jsxs)("div",{style:{position:"relative",minHeight:500},children:[Object(O.jsx)(b.a,{ref:e,audio:!1,mirrored:!0,videoConstraints:{deviceId:z,width:{ideal:250},height:{ideal:200}},onUserMedia:G,style:{position:"absolute",top:0,left:0}},JSON.stringify(D)),Object(O.jsx)("pre",{style:{position:"fixed",bottom:0,left:0,backgroundColor:"black",color:"white",fontSize:20},children:r}),Object(O.jsx)("canvas",{ref:t,style:{position:"absolute",top:0,left:0,zIndex:999999}})]})]})})},m=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,259)).then((function(t){var n=t.getCLS,i=t.getFID,o=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),i(e),o(e),r(e),c(e)}))};c.a.render(Object(O.jsx)(o.a.StrictMode,{children:Object(O.jsx)(y,{})}),document.getElementById("root")),m()}},[[257,1,2]]]);
//# sourceMappingURL=main.6cfd71ad.chunk.js.map