(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{165:function(e,t,n){},267:function(e,t,n){},299:function(e,t){},300:function(e,t){},308:function(e,t){},312:function(e,t,n){"use strict";n.r(t);var c=n(23),a=n.n(c),i=n(240),s=n.n(i),o=(n(267),n(51)),r=n(8),l=n.p+"static/media/logo.88e8f6f6.png",u=n(18);function d(){return Object(u.jsxs)(u.Fragment,{children:[" ",Object(u.jsxs)("div",{className:"Nav",children:[Object(u.jsx)("img",{src:l,alt:""}),Object(u.jsx)("h1",{children:"SongSmash"}),Object(u.jsx)("div",{className:"filler"}),Object(u.jsx)("div",{className:"link",children:Object(u.jsx)("a",{href:"https://devpost.com/software/songsma-sh-tagline",children:"Devpost"})}),Object(u.jsx)("div",{className:"link",children:Object(u.jsx)("a",{href:"https://github.com/samyok/songsma.sh",target:"_blank",children:"GitHub"})})]}),Object(u.jsx)("div",{className:"Footer",children:"Made by Samyok Nepal, Allen Chang, Sampada Nepal, and Jason Chang"})]})}var j=n.p+"static/media/bluedouble.e532cd58.png",h=n.p+"static/media/redsingle.7bce6aa2.png",b=(n(165),n(241)),f=n.n(b),O=n(21),p=n(9),m=n.n(p),v=n(15),x=n(3),g=n(7),w=n(242),y=n.n(w),k=(n(311),n(261));function S(e,t){var n=Object(c.useRef)();Object(c.useEffect)((function(){n.current=e}),[e]),Object(c.useEffect)((function(){if(null!==t){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}}),[t])}var _=n(16),M=n(260),N=function(){function e(t){Object(x.a)(this,e),this._a=[],this._n=t}return Object(g.a)(e,[{key:"add",value:function(e){this._a.push(e),this._a.length>this._n&&this._a.shift()}},{key:"velocity",value:function(){return(this._a[0]-this._a[this._a.length-1])/this._a.length}}]),e}();var P=function(e){var t=e.setLoading,n=e.data,a=e.setPage,i=n.hash,s=n.level,l=n.result,d=n.multiplayer,j=(n.socket,l._beatsPerMinute),h=Date.now(),b=function(e){return new Promise((function(t){return setTimeout(t,e)}))},f=function(e){var t=Object(c.useState)(new Audio(e)),n=Object(r.a)(t,1)[0],a=Object(c.useState)(!1),i=Object(r.a)(a,2),s=i[0],o=i[1];return Object(c.useEffect)((function(){s?n.play():n.pause()}),[s]),Object(c.useEffect)((function(){return n.addEventListener("ended",(function(){return o(!1)})),function(){n.removeEventListener("ended",(function(){return o(!1)}))}}),[]),[s,function(){return o(!s)}]}("/audioapi/".concat(i,"/").concat(l._songFilename)),p=Object(r.a)(f,2),x=p[0],g=p[1],w=Object(c.useRef)(),P=Object(c.useRef)(),E=Object(c.useState)("string"),I=Object(r.a)(E,2),z=(I[0],I[1],Object(c.useState)()),C=Object(r.a)(z,2),F=C[0],L=C[1],W=Object(c.useState)(),R=Object(r.a)(W,2),A=R[0],D=R[1],T=Object(c.useState)(100),H=Object(r.a)(T,2),Y=(H[0],H[1]),J=Object(c.useState)(localStorage.getItem("CameraId")||{}),B=Object(r.a)(J,2),U=B[0],X=B[1],q=Object(c.useState)([]),Z=Object(r.a)(q,2),G=Z[0],V=Z[1],$=Object(c.useState)(null),K=Object(r.a)($,2),Q=K[0],ee=K[1],te=Object(c.useState)(null),ne=Object(r.a)(te,2),ce=ne[0],ae=ne[1],ie=Object(c.useState)(null),se=Object(r.a)(ie,2),oe=se[0],re=se[1],le=Object(c.useState)(new N(Math.round(5))),ue=Object(r.a)(le,2),de=ue[0],je=(ue[1],Object(c.useState)(new N(Math.round(5)))),he=Object(r.a)(je,2),be=he[0],fe=(he[1],Object(c.useState)(new N(Math.round(5)))),Oe=Object(r.a)(fe,2),pe=Oe[0],me=(Oe[1],Object(c.useState)(new N(Math.round(5)))),ve=Object(r.a)(me,2),xe=ve[0],ge=(ve[1],Object(c.useState)(0)),we=Object(r.a)(ge,2),ye=we[0],ke=(we[1],Object(c.useState)(50)),Se=Object(r.a)(ke,2),_e=Se[0],Me=Se[1];Object(c.useEffect)((function(){if(!(_e>0))return window.location.href="/win/".concat(i,"/").concat(ye,"/loss"),a({page:"gameFinsihed",data:Object(o.a)(Object(o.a)({},n),{},{win:"lose",score:ye})})}),[ye,_e]);var Ne=Object(c.useState)(null),Pe=Object(r.a)(Ne,2),Ee=(Pe[0],Pe[1],Object(c.useState)(null)),Ie=Object(r.a)(Ee,2),ze=Ie[0];Ie[1],Object(c.useEffect)((function(){window.addEventListener("resize",(function(e){window.location.reload()})),window.document.addEventListener("keypress",(function(e){"k"===e.key&&(window.location.href="/win/".concat(i,"/").concat(ye,"/loss"),a({page:"gameFinished",data:Object(o.a)(Object(o.a)({},n),{},{score:ye,win:"lose"})}))}))}),[]),S((function(){var e,t;F&&w.current&&(null===(e=w.current)||void 0===e?void 0:e.video)&&4===w.current.video.readyState&&(null===F||void 0===F?void 0:F.estimateSinglePose)&&(null===(t=P.current)||void 0===t?void 0:t.getContext)&&F.estimateSinglePose(w.current.video,{flipHorizontal:!0}).then((function(e){if(P.current){var t=P.current.getContext("2d");t.fillStyle="red",t.clearRect(0,0,t.canvas.width,t.canvas.height),e.keypoints.filter((function(e){return e.score>.1})).filter((function(e){return e.part.includes("Wrist")})).forEach((function(e){t.fillRect(e.position.x,e.position.y,6,6)}));e.keypoints.filter((function(e){return"nose"===e.part}))[0].position.x;D((function(t){var n=t||{};return e.keypoints.forEach((function(e){n[e.part]=e.position})),n})),A&&A.leftWrist&&A.leftElbow&&(ce&&(ce.scene.scale.set(.1,.1,.1),ce.scene.position.x=A.leftWrist.x/Q.w*5-2.5,ce.scene.position.y=2-A.leftWrist.y/Q.h*3.5,ce.scene.position.z=6),oe&&(oe.scene.scale.set(.1,.1,.1),oe.scene.position.x=A.rightWrist.x/Q.w*5-2.5,oe.scene.position.y=1-A.rightWrist.y/Q.h*3,oe.scene.position.z=6))}}))}),40);var Ce=Object(c.useCallback)((function(e){t("Setting up webcam..."),V(e.filter((function(e){return"videoinput"===e.kind})))}),[V]),Fe=Object(c.useCallback)(function(){var e=Object(v.a)(m.a.mark((function e(n){var c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(n,w.current.video);case 1:if(n.active&&w.current.video&&4===w.current.video.readyState&&P.current){e.next=6;break}return e.next=4,b(50);case 4:e.next=1;break;case 6:n.active&&w.current.video&&(c={w:w.current.video.videoWidth,h:w.current.video.videoHeight},ee(c),P.current.height=c.h,P.current.width=c.w,w.current.video.height=c.h,w.current.video.width=c.w,t("Setting up TensorFlow..."),Le({width:c.w,height:c.h}).then((function(e){L(e)})));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]);function Le(e){return We.apply(this,arguments)}function We(){return(We=Object(v.a)(m.a.mark((function e(t){var n,c,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.width,c=t.height,e.next=3,k.a({architecture:"MobileNetV1",outputStride:16,inputResolution:{width:n,height:c},multiplier:.75});case 3:return a=e.sent,console.log("loaded posenet."),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(c.useEffect)((function(){navigator.mediaDevices.enumerateDevices().then(Ce)}),[Ce]);var Re=Object(c.useState)([]),Ae=Object(r.a)(Re,2),De=Ae[0],Te=Ae[1],He=Object(c.useState)(null),Ye=Object(r.a)(He,2),Je=Ye[0],Be=Ye[1],Ue=Object(c.useState)(),Xe=Object(r.a)(Ue,2),qe=Xe[0],Ze=Xe[1],Ge=Object(c.useState)(),Ve=Object(r.a)(Ge,2),$e=Ve[0],Ke=Ve[1];function Qe(){return(Qe=Object(v.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:x||setTimeout((function(){return g()}),500),s._notes=s._notes.map((function(e){return Object(o.a)(Object(o.a)({},e),{},{playAt:6e4*e._time/j+h})})),t=0;case 3:if(!(t<s._notes.length)){e.next=10;break}return e.next=6,b(s._notes[t].playAt-Date.now());case 6:nt(s._notes[t]._lineIndex,s._notes[t]._lineLayer,s._notes[t]._type,s._notes[t]._cutDirection);case 7:t++,e.next=3;break;case 10:return e.next=12,b(3e3);case 12:window.location.href=d?"/win/".concat(i,"/").concat(ye,"/tie"):"/win/".concat(i,"/").concat(ye,"/win"),a({page:"gameFinished",data:Object(o.a)(Object(o.a)({},n),{},{score:ye,win:"win"})});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}Object(c.useEffect)(Object(v.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A){e.next=2;break}return e.abrupt("return");case 2:t(!1),Ze(new _.ab);case 4:case"end":return e.stop()}}),e)}))),[A]);var et=Object(c.useCallback)((function(e,t){return Me((function(e){return Math.min(e+3,100)})),Te((function(n){for(var c=0;c<n.length;c++)if(n[c]&&n[c].scene.position.x===e&&n[c].scene.position.y===t)return qe.remove(n[c].scene),n.splice(c,1),n;return n}))}),[qe]);Object(c.useEffect)((function(){qe&&(qe.background=null,function(){return Qe.apply(this,arguments)}().then((function(){console.log("done with loop")})),Ke(new _.R(75,window.innerWidth/window.innerHeight,.2,1e3)),Be(new _.mb({alpha:!0})))}),[qe]);var tt=new M.a;function nt(e,t,n,c){function a(a){switch(qe.add(a.scene),a.scene.position.z=0,a.scene.position.x=e-1.5,a.scene.position.y=t-1.5,a.scene.scale.set(.42,.42,.42),a.scene.rotation.x+=Math.PI,a.scene.rotation.z+=Math.PI,Te((function(e){return[].concat(Object(O.a)(e),[{scene:a.scene,type:n,cutDirection:c}])})),c[0]){case 0:a.scene.rotation.z+=Math.PI;break;case 1:break;case 2:a.scene.rotation.z+=Math.PI/2;break;case 3:a.scene.rotation.z+=3*Math.PI/2;break;case 4:a.scene.rotation.z+=5*Math.PI/4;break;case 5:a.scene.rotation.z+=Math.PI/4;break;case 6:a.scene.rotation.z+=7*Math.PI/4;break;case 7:a.scene.rotation.z+=5*Math.PI/4}}0===n&&tt.load("/redbox.glb",a),1===n&&tt.load("/bluebox.glb",a)}function ct(e){var t=e.x,n=e.y,c=e.z,a=e.file,i=e.rotX,s=e.rotY,o=e.rotZ,r=e.callback;tt.load(a,(function(e){qe.add(e.scene),e.scene.scale.set(.42,.42,.42),e.scene.position.x=t,e.scene.position.y=n,e.scene.position.z=c,e.scene.rotation.x=i,e.scene.rotation.y=s,e.scene.rotation.z=o,r&&r(e)}))}return Object(c.useEffect)((function(){if(Je&&qe){Je.setSize(window.innerWidth,window.innerHeight),Je.outputEncoding=_.nb,document.body.appendChild(Je.domElement);var e=new _.S(4,5e3,1),t=new _.H({color:"white",side:_.j,opacity:.5,transparent:!0}),n=new _.G(e,t);n.rotateX(Math.PI/2),n.position.y-=2,qe.add(n);var c=[];c[0]=new _.T(16777215,5,0),c[1]=new _.T(16777215,.1,0),c[0].position.set(0,200,5),c[1].position.set(0,0,200);for(var a=0;a<c.length;a++)qe.add(c[a]);qe.fog=new _.l("black",5,15),ct({x:0,y:0,z:6,file:"/bluesphere.glb",rotZ:Math.PI/2,rotY:0,rotX:0,callback:function(e){return re(e)}}),ct({x:0,y:0,z:6,file:"/redsphere.glb",rotZ:Math.PI/2,rotY:0,rotX:0,callback:function(e){return ae(e)}}),$e.position.z=10}}),[Je]),S((function(){if(Je){for(var e=0;e<De.length;e++)De[e].scene.position.z+=.0012*j,De[e].scene.position.z>7.5&&(qe.remove(De[e].scene),De.splice(e,1),Me((function(e){return Math.max(0,e-15)})));if(ce&&oe&&(de.add(ce.scene.position.x),be.add(ce.scene.position.y),pe.add(oe.scene.position.x),xe.add(oe.scene.position.y)),oe)for(var t=0;t<De.length;t++)Math.abs(De[t].scene.position.x-oe.scene.position.x)<.75&&Math.abs(De[t].scene.position.y-oe.scene.position.y)<.75&&Math.abs(De[t].scene.position.z-6)<1&&1===De[t].type&&(console.log("BREAK",De[t].cutDirection,ze),et(De[t].scene.position.x,De[t].scene.position.y));if(ce)for(var n=0;n<De.length;n++)Math.abs(De[n].scene.position.x-ce.scene.position.x)<.75&&Math.abs(De[n].scene.position.y-ce.scene.position.y)<.75&&Math.abs(De[n].scene.position.z-6)<1&&0===De[n].type&&et(De[n].scene.position.x,De[n].scene.position.y);Je.render(qe,$e)}}),40),Object(c.useCallback)((function(){if(A){var e=Math.sqrt(Math.pow(A.leftWrist.x-A.leftElbow.x,2)+Math.pow(A.leftWrist.y-A.leftElbow.y,2));Y(e)}}),[A]),Object(u.jsx)(u.Fragment,{children:Object(u.jsxs)("div",{children:[Object(u.jsx)("select",{value:U,onChange:function(e){X(e.currentTarget.value),localStorage.setItem("CameraId",e.currentTarget.value)},children:G.map((function(e,t){return Object(u.jsx)("option",{value:e.deviceId,children:e.label||"Device ".concat(t+1)},e.deviceId)}))}),Object(u.jsx)("br",{}),Object(u.jsxs)("div",{style:{position:"relative",minHeight:500},children:[Object(u.jsx)(y.a,{ref:w,audio:!1,mirrored:!0,videoConstraints:{deviceId:U,width:{ideal:250},height:{ideal:200}},onUserMedia:Fe,style:{position:"absolute",top:0,left:0}},JSON.stringify(Q)),Object(u.jsx)("div",{className:"score-container",children:Object(u.jsx)("div",{className:"score",style:{width:"".concat(_e,"%")},children:"\xa0"})}),Object(u.jsx)("canvas",{ref:P,style:{position:"absolute",top:0,left:0,zIndex:999999}})]})]})})};function E(e){var t=e.data,n=e.setPage,a=Object(c.useState)("Loading..."),i=Object(r.a)(a,2),s=i[0],o=i[1];return Object(u.jsxs)(u.Fragment,{children:[!!s&&Object(u.jsx)("div",{style:{width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.7)",position:"fixed",top:0,left:0,color:"white",display:"flex",justifyContent:"center",alignItems:"center",fontSize:50},children:s}),Object(u.jsx)("div",{children:Object(u.jsx)(P,{setLoading:o,data:t,setPage:n})})]})}function I(e){var t=e.setPage,n=e.data,a=(e.socket,Object(c.useState)([])),i=Object(r.a)(a,2),s=i[0],o=i[1],l=Object(c.useState)(""),j=Object(r.a)(l,2),h=j[0],b=(j[1],Object(c.useCallback)((function(){fetch("/search?q="+h).then((function(e){return e.json()})).then((function(e){return o(e)}))}),[]));return Object(c.useEffect)((function(){fetch("/search?q="+h).then((function(e){return e.json()})).then((function(e){return o(e)}))}),[]),Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(d,{}),Object(u.jsxs)("div",{className:"songLoader",children:[Object(u.jsxs)("div",{className:"header",children:["Song Selection - ",n.mode.toLocaleUpperCase().split("_").join(" ")]}),"join_multiplayer"===n.mode&&Object(u.jsx)("div",{className:"header",children:"Waiting to start!"}),Object(u.jsx)("div",{className:"search",children:Object(u.jsx)("button",{onClick:b,children:"Re-roll songs"})}),Object(u.jsx)("div",{className:"listResults",children:Object(u.jsx)("ul",{children:s.map((function(e){return Object(u.jsxs)("li",{children:[Object(u.jsx)("img",{src:"/api/".concat(e.hash,"/").concat(e._coverImageFilename),alt:"cover art"}),Object(u.jsxs)("div",{className:"info",children:[Object(u.jsx)("h3",{children:e._songName}),Object(u.jsx)("p",{className:"author",children:e._songAuthorName}),e._difficultyBeatmapSets.filter((function(e){return"standard"===e._beatmapCharacteristicName.toLowerCase()}))[0]._difficultyBeatmaps.map((function(c){return Object(u.jsx)("button",{onClick:function(){fetch("/api/".concat(e.hash,"/").concat(c._beatmapFilename)).then((function(e){return e.text()})).then((function(c){t({view:"multiplayer"===n.mode?"waitforteam":"game",data:{hash:e.hash,level:JSON.parse(c),result:e}})}))},children:c._difficulty})})),Object(u.jsxs)("p",{className:"info",children:["\u23f1\ufe0f",e._beatsPerMinute]})]})]})}))})})]})]})}function z(e){var t=e.data,n=e.socket,a=e.setPage,i=Object(c.useState)(!1),s=Object(r.a)(i,2),l=s[0];s[1];return Object(c.useEffect)((function(){n.emit("looking",t),n.on("joined",(function(){a({view:"game",data:Object(o.a)(Object(o.a)({},t),{},{multiplayer:!0,socket:n})})}))}),[]),Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(d,{}),Object(u.jsxs)("div",{className:"hero",children:[!l&&Object(u.jsx)("h2",{children:"Waiting for someone to join you..."}),l&&Object(u.jsx)("h2",{children:"Someone joined!!!"}),!l&&Object(u.jsxs)("p",{children:["they should go to"," ",Object(u.jsxs)("a",{style:{color:"white"},href:"https://songsma.sh/m/".concat(n.id),children:["https://songsma.sh/m/",n.id]})]}),l&&Object(u.jsx)("p",{children:"the game will start in a couple seconds"})]})]})}function C(e){e.data,e.setPage;var t=Object(c.useState)({}),n=Object(r.a)(t,2),a=n[0],i=n[1];Object(c.useEffect)((function(){fetch("/api/hash/"+window.location.pathname.split("/")[2]).then((function(e){return e.json()})).then((function(e){return i(e)}))}));var s={win:0,loss:1,tie:2}[window.location.pathname.split("/")[4]],o=[["won!","lost :c","tied?!?!"][s],["You beat your opponent in the truest battle of true wits.","you'll get 'em next time c:","how did that happen???"][s]];return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(d,{}),Object(u.jsxs)("div",{className:"hero",children:[Object(u.jsxs)("h2",{children:["You ",o[0]]}),Object(u.jsx)("p",{children:o[1]}),Object(u.jsxs)("div",{className:"flex",style:{textAlign:"center"},children:[Object(u.jsx)("img",{style:{maxWidth:200},src:"/api/".concat(a.hash,"/").concat(a._coverImageFilename),alt:""}),Object(u.jsxs)("h3",{style:{textAlign:"center"},children:[a._songAuthorName," - $",a._songName]}),Object(u.jsxs)("h6",{children:["Thank ",Object(u.jsxs)("u",{children:["$",a._levelAuthorName]})," for such writing the level :)!"]}),Object(u.jsx)("button",{onClick:function(){return window.location.href="/re/"},children:"Play again"})]})]})]})}function F(){var e=Object(c.useState)({view:"home",data:{}}),t=Object(r.a)(e,2),n=t[0],a=t[1];Object(c.useEffect)((function(){console.log(n)}),[n]);var i=Object(c.useState)({}),s=Object(r.a)(i,2),l=s[0],b=s[1];return Object(c.useEffect)((function(){window.location.href.includes("/win/")?a({view:"gameFinished",data:null}):window.location.href.includes("/m/")||window.location.href.includes("/re/")&&a({view:"selectMode",data:{mode:""}}),fetch("/wsinfo").then((function(e){return e.json()})).then((function(e){var t=f()(e.endpoint);b(t),console.log({s:t}),window.location.pathname.includes("/m/")&&t.emit("joinRoom",window.location.pathname.split("/")[2],(function(e){a({view:"game",data:Object(o.a)(Object(o.a)({},e),{},{multiplayer:!0,socket:l})})}))}))}),[]),Object(u.jsxs)(u.Fragment,{children:["home"===n.view&&Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(d,{}),Object(u.jsxs)("div",{className:"hero",children:[Object(u.jsx)("h2",{children:"No VR headset?"}),Object(u.jsx)("p",{children:"Use your webcam to exercise to your favorite songs!"}),Object(u.jsx)("button",{onClick:function(){return a({view:"selectMode",data:{}})},children:"Play now"})]})]}),"selectMode"===n.view&&Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(d,{}),Object(u.jsxs)("div",{className:"selectMode",children:[Object(u.jsxs)("div",{className:"choice",onClick:function(){return a({view:"songLoader",data:{mode:"solo"}})},children:[Object(u.jsx)("img",{src:h,alt:"SOLO"}),Object(u.jsx)("p",{children:"SOLO"})]}),Object(u.jsxs)("div",{className:"choice",onClick:function(){return a({view:"songLoader",data:{mode:"multiplayer"}})},children:[Object(u.jsx)("img",{src:j,alt:"Multiplayer"}),Object(u.jsx)("p",{children:"MULTIPLAYER"})]})]})]}),"songLoader"===n.view&&Object(u.jsx)(I,{setPage:a,data:n.data,socket:l}),"gameFinished"===n.view&&Object(u.jsx)(C,{data:n.data,setPage:a}),"game"===n.view&&Object(u.jsx)(E,{data:n.data,setPage:a}),"waitforteam"===n.view&&Object(u.jsx)(z,{data:n.data,setPage:a,socket:l})]})}s.a.render(Object(u.jsx)(a.a.StrictMode,{children:Object(u.jsx)(F,{})}),document.getElementById("root"))}},[[312,1,2]]]);
//# sourceMappingURL=main.223707c2.chunk.js.map